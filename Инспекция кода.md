# Инспекция кода



​	Инспекция кода – это систематическая проверка исходного кода программы. Цель проверки – обнаружение и исправление ошибок, которые были пропущены, остались незамечены при разработке. Результат инспекции как правило – улучшение качество ПО и навыки разработчика.

​	В ходе инспекции, когда могут быть найдены, с последующим устранением, такие уязвимости, как ошибки в форматировании строк, утечка памяти, переполнение буфера, что улучшает безопасность ПО. Системы контроля версий также дают возможность проведения совместной инспекции исходного кода. Помимо этого, есть инструменты, которые предназначены именно для совместной инспекции.

### На что смотреть во время инспекции

#### Архитектура/Дизайн

- **Принцип «одной ответственности».** Идея в том, что у каждого класса должно быть только одно назначение. На самом деле реализовать это труднее, чем кажется. Я обычно применяю это правило и к методам. Если возникает нужда в союзе «и» при описании того, что делает метод, то это знак, что стоит разделить его на несколько более простых.
- **Принцип «Открыт/Закрыт».** Если язык объектно-ориентированный, то открыты ли ваши объекты для расширения, но закрыты для модификации? Что произойдет, если нам нужно будет добавить еще один экземпляр класса `x`?
- **Слепой тест.** Если расфокусировать зрение, то выглядит ли форма кода, на который вы смотрите, идентичной другим кускам кода? Если нет, то это может быть сигналом к тому, что код нуждается в рефакторинге.
- **При изменении кода всегда пытайтесь его улучшить.** Обычно, если я исправляю какую-то часть кода, которая работает неправильно или выглядит некрасиво, у меня всегда возникает искушение просто исправить несколько строчек и на этом закончить. Я рекомендую не останавливаться на этом и сделать код лучше, чем он был.
- **Потенциальные баги.** Просматривайте код на наличие ошибок-на-единицу, нарушений условий циклов и т.д.
- **Обработка ошибок.** Достаточно ли хороша обработка ошибок? Введены ли кастомные исключения? Если да, то полезны ли они?
- **Эффективность.** Если используется какой-либо алгоритм, эффективна ли его реализация? Например, пробег по всем ключам словаря — не лучший способ найти нужное значение.

#### Стиль

- **Имена методов.** Давать имена различным вещам — одна из самых сложных задач в программировании. Если метод называется `get_message_queue_name()`, но делает что-то кроме этого, например, убирает HTML из входных данных, тогда это имя не подходит ему.
- **Имена переменных.** `foo` и `bar` — не самые лучшие имена для структур данных. `e` также не настолько красноречиво, как `exception`. Будьте как можно лаконичнее. Говорящие имена переменных облегчат чтение кода в будущем.
- **Длина функций.** Я придерживаюсь правила, говорящего, что функция не должна быть длиннее 20 строк. Если я вижу метод больше 50 строк, я пытаюсь разбить его на два.
- **Длина классов.** Классы должны быть меньше 300 строк, а в идеале — меньше 100. Скорее всего, если в вашем коде есть длинные классы, то их можно разбить на несколько, что облегчит понимание их предназначения.
- **Длина файла.** Для Python 1000 строк в одном файле — предел. Если их становится больше, то, возможно, стоит разбить файл на несколько, с более специфичным предназначением. Чем больше файл, тем меньше читабельность кода в нем.
- **Документация.** Сложные методы лучше задокументировать так, чтобы было понятно, за что отвечает каждый аргумент. Разве это не очевидно?
- **Закомментированный код.** Стоит удалить закомментированные строки кода, чтобы не было ничего лишнего.
- **Количество аргументов в методе.** Посмотрите, сколько аргументов передается в ваш метод. Больше трех? Это знак того, что они могут быть сгруппированы по-другому.
- **Читабельность.** Легко ли разобраться в вашем коде? Часто ли вы делаете паузы во время чтения, чтобы разобраться в нем?

#### Тестирование

- **Полнота тестов.** Мне нравится, когда нововведения тестируются. Но насколько эти тесты продуманы? Могут ли они заставить ваш код упасть? Легко ли они читаются? Насколько они хрупки? Насколько они большие? Медленные ли они?

- **Тестирование на правильном уровне.** Когда я рассматриваю тесты, я должен убедиться в том, что они проводят тестирование на правильном уровне. Иными словами, тестируется ли тот уровень приложения, который нужно тестировать для проверки функциональности? Гарри Бернардт рекомендует такое соотношение — 95% юнит-тестов и 5% интеграционных тестов. Особенно это относится к проектам, использующим Django.

- **Количество объектов-имитаций.** Имитационные объекты хороши, но не стоит пихать их везде. Если в тесте их более трех штук, нужно его переписать. Либо тест, либо сама функция, для которой он предназначен, охватывают слишком большую часть кода. В обоих случаях это стоит обсудить.

- **Соответствование требованиям.** Обычно в конце инспектирования я смотрю на задачу или баг, для которого был предназначен тест. Если он не соответствует каким-то критериям, то лучше провести тестирование заново.

  

Источники:

[animatika]: https://animatika.ru/info/gloss/code-review.html#:~:text=%D0%98%D0%BD%D1%81%D0%BF%D0%B5%D0%BA%D1%86%D0%B8%D1%8F%20%D0%BA%D0%BE%D0%B4%D0%B0%20(%D1%80%D0%B5%D0%B2	"first"
[tproger]: https://tproger.ru/translations/code-review-best-practices/	"second"

